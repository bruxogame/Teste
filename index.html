
<!DOCTYPE html>
<html>
<head>
  <title>Exemplo de servidor WebSocket</title>
</head>
<body>
  <h1>Servidor WebSocket</h1>

  <script>
    // Cria uma nova conexão WebSocket
    const socket = new WebSocket('ws://localhost:3000');

    // Quando a conexão é estabelecida
    socket.onopen = () => {
      console.log('Conexão estabelecida');
    };

    // Quando uma mensagem é recebida
    socket.onmessage = (event) => {
      console.log('Mensagem recebida:', event.data);
    };

    // Quando a conexão é fechada
    socket.onclose = () => {
      console.log('Conexão fechada');
    };

    // Envia uma mensagem para o servidor WebSocket
    function enviarMensagem() {
      const mensagem = document.getElementById('mensagem').value;
      socket.send(mensagem);
    }
  </script>
  
  <input type="text" id="mensagem" placeholder="Digite uma mensagem">
  <button onclick="enviarMensagem()">Enviar</button>

  <script>
    // Código do servidor WebSocket
    const WebSocket = require('ws');

    // Cria um novo servidor WebSocket
    const wss = new WebSocket.Server({ port: 3000 });

    // Quando uma conexão é estabelecida
    wss.on('connection', (ws) => {
      console.log('Nova conexão estabelecida');

      // Quando uma mensagem é recebida
      ws.on('message', (message) => {
        console.log('Mensagem recebida:', message);

        // Envia a mensagem para todos os clientes conectados
        wss.clients.forEach((client) => {
          if (client.readyState === WebSocket.OPEN) {
            client.send(message);
          }
        });
      });

      // Quando a conexão é fechada
      ws.on('close', () => {
        console.log('Conexão fechada');
      });
    });
  </script>
</body>
</html>

